
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Select2 AJAX Auto Complete with CakePHP 2.0 - blog.rudylee.com</title>
  <meta name="author" content="Rudy Lee">

  
  <meta name="description" content="Demo : http://cbunny2.rudylee.com/users/select2 Source : https://github.com/rudylee/cbunny In this post, I&rsquo;ll explain how to use Select2 inside &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rudylee.github.io/blog/2013/02/02/select2-ajax-auto-complete-with-cakephp-2-0/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="blog.rudylee.com" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">mob</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">blog.rudylee.com</a></h1>
  
    <h2>keep it humble</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rudylee.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">Select2 AJAX Auto Complete With CakePHP 2.0</h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2013-02-02T19:09:26+11:00" pubdate data-updated="true">Feb 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Demo : <a href="http://cbunny2.rudylee.com/users/select2">http://cbunny2.rudylee.com/users/select2</a></h2>

<p>Source : <a href="https://github.com/rudylee/cbunny">https://github.com/rudylee/cbunny</a></p>

<p>In this post, I&rsquo;ll explain how to use <a href="http://ivaynberg.github.com/select2/">Select2</a> inside CakePHP. We will avoid using any helpers and rely on jQuery + Javascript. Before we start, I presume you have downloaded Select2 and included the Javascript and CSS files inside your layout. Thus, I won&rsquo;t explain how to import Select2 library into your CakePHP app ( you can download my cbunny app from Github if you are lost ).</p>

<p>So the first step is to create controller that will contain our Select2 search box. In this tutorial, I&rsquo;ll create users controller and one action to put the select2 search box. Here is the snippet of my code :</p>

<pre><code>    public function select2() {
        $this-&gt;User-&gt;recursive = 0;
        $this-&gt;set('users', $this-&gt;paginate());
    }
</code></pre>

<p>After this you can create the view ( View/Users/select2.ctp ). Here is my view code :</p>

<pre><code>&lt;div class="row"&gt;
    &lt;div class="span12"&gt;

    &lt;!-- Select2 Auto Complete --&gt;
    &lt;div class="pull-right"&gt;
        &lt;input type="text" id="user-select2"&gt;
    &lt;/div&gt;

    &lt;h2&gt;&lt;?php echo __('Users');?&gt;&lt;/h2&gt;
    &lt;table class="table"cellpadding="0" cellspacing="0"&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;&lt;?php echo $this-&gt;Paginator-&gt;sort('id');?&gt;&lt;/th&gt;
                &lt;th&gt;&lt;?php echo $this-&gt;Paginator-&gt;sort('username');?&gt;&lt;/th&gt;
                &lt;th&gt;&lt;?php echo $this-&gt;Paginator-&gt;sort('password');?&gt;&lt;/th&gt;
                &lt;th&gt;&lt;?php echo $this-&gt;Paginator-&gt;sort('created');?&gt;&lt;/th&gt;
                &lt;th&gt;&lt;?php echo $this-&gt;Paginator-&gt;sort('modified');?&gt;&lt;/th&gt;
                &lt;th class="actions"&gt;&lt;?php echo __('Actions');?&gt;&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            &lt;?php foreach ($users as $user): ?&gt;
            &lt;tr&gt;
                &lt;td&gt;&lt;?php echo h($user['User']['id']); ?&gt; &lt;/td&gt;
                &lt;td&gt;&lt;?php echo h($user['User']['username']); ?&gt; &lt;/td&gt;
                &lt;td&gt;&lt;?php echo h($user['User']['password']); ?&gt; &lt;/td&gt;
                &lt;td&gt;&lt;?php echo h($user['User']['created']); ?&gt; &lt;/td&gt;
                &lt;td&gt;&lt;?php echo h($user['User']['modified']); ?&gt; &lt;/td&gt;
                &lt;td class="actions"&gt;
                    &lt;?php echo $this-&gt;Html-&gt;link(__('View'), array('action' =&gt; 'view', $user['User']['id'])); ?&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
            &lt;?php endforeach; ?&gt;
        &lt;/tbody&gt;
    &lt;/table&gt;
&lt;/div&gt;
</code></pre>

<p>If you look at 5-7 you&rsquo;ll notice that I have input element with id element user-select2. We will use the ID inside our jQuery to initiate the Select2. The next step after this is to create a Javascript object to store the dynamic app path. Add this snippet of code into your layout file ( default.ctp ).</p>

<pre><code>        $cbunny = array(
            'APP_PATH' =&gt; Router::url('/',true)
        );
        echo $this-&gt;Html-&gt;scriptBlock('var CbunnyObj = ' . $this-&gt;Javascript-&gt;object($cbunny) . ';');
</code></pre>

<p>You can change the $cbunny and CBunnyObj variable name to resemble your app name. However, the rest of the code has to be same as above. This snippet of code will create Javascript object which contains the root URL path of CakePHP.</p>

<p>After we have the Javascript object, we will create jQuery code to create Select2 search box, process AJAX request and handle the respond. I&rsquo;ll start with creating cbunny.js file inside my webroot folder and add the file in my layout file. Here is the code :</p>

<pre><code>/*global $, document, CbunnyObj */
$(document).ready(function () {

  $('#user-select2').select2({
    placeholder: "Search user auto complete",
    minimumInputLength: 1,
    ajax: {
      url: CbunnyObj.APP_PATH + 'users/search',
      dataType: 'json',
      data: function (term, page) {
        return {
          q: term
        };
      },
      results: function (data, page) {
        return { results: data };
      }
    }
  });

});
</code></pre>

<p>I&rsquo;ll explain the Javascript code a little bit. Line 4-19 contain the definition of Select2 library. You can see we have ajax definition on line 7 which will perform AJAX request to  CbunnyObj.APP_PATH + &lsquo;users/search&rsquo;. CbunnyObj is javascript object variable that we have defined before and will translate into your CakePHP App path ( ex: <a href="http://cbunny.rudylee.com">http://cbunny.rudylee.com</a> ). I believe you understand the rest of the code as I just copied it from Select2 website.</p>

<p>After this, our last step is to create action + view to handle the AJAX request. So we are going back to Users controller and add new action called &lsquo;search&rsquo;. Here is my &lsquo;search&rsquo; action code :</p>

<pre><code>    public function search() {
        $this-&gt;autoRender = false;

        // get the search term from URL
        $term = $this-&gt;request-&gt;query['q'];
        $users = $this-&gt;User-&gt;find('all',array(
            'conditions' =&gt; array(
                'User.username LIKE' =&gt; '%'.$term.'%'
            )
        ));

        // Format the result for select2
        $result = array();
        foreach($users as $key =&gt; $user) {
            $result[$key]['id'] = (int) $user['User']['id'];
            $result[$key]['text'] = $user['User']['username'];
        }
        $users = $result;

        echo json_encode($users);
    }
</code></pre>

<p>On line 5, we grab the search query term from the URL and store into $term variable. After that, we will perform normal query to the table. When we get the result, we won&rsquo;t be able to use it straight away. We will have to reformat it so it can be readable by Select2. On line 12-17 we basically iterate through the $users variable and create new associative array which has id and text as their key.</p>

<p>That&rsquo;s it for the tutorial. If you are confuse, feel free to write comment below and I&rsquo;ll be happy to answer them.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">admin</span></span>

      








  


<time datetime="2013-02-02T19:09:26+11:00" pubdate data-updated="true">Feb 2<span>nd</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/cakephp/'>CakePHP</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rudylee.github.io/blog/2013/02/02/select2-ajax-auto-complete-with-cakephp-2-0/" data-via="" data-counturl="http://rudylee.github.io/blog/2013/02/02/select2-ajax-auto-complete-with-cakephp-2-0/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/blog/2013/01/15/science-of-productivity/" title="Previous Post: Science of Productivity">&laquo; Science of Productivity</a>
      
      
        <a class="basic-alignment right articlenav" href="/blog/2013/02/02/bootstrap-typeahead-cakephp-2-0/" title="Next Post: Bootstrap Typeahead CakePHP 2.0">Bootstrap Typeahead CakePHP 2.0 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/05/27/playing-with-google-map-api/">Playing with Google Map API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/16/override-module-config-in-zend-framework-2/">Override module config in Zend Framework 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/06/zend-framework-2-the-proper-way-to-set-application-path-in-javascript-object/">Zend Framework 2 : The proper way to set application path in Javascript Object</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/30/my-review-after-two-months-using-vim/">My review after two months using VIM</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/15/zend-framework-2-get-server-url-in-controller-without-using-serverurl/">Zend Framework 2 : get server URL in controller without using serverUrl()</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Rudy Lee -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blogrudylee';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://rudylee.github.io/blog/2013/02/02/select2-ajax-auto-complete-with-cakephp-2-0/';
        var disqus_url = 'http://rudylee.github.io/blog/2013/02/02/select2-ajax-auto-complete-with-cakephp-2-0/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
