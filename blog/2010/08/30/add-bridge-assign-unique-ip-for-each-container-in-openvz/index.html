
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Add bridge and assign unique IP for each container in OpenVZ - blog.rudylee.com</title>
  <meta name="author" content="Rudy Lee">

  
  <meta name="description" content="I am writing this tutorial to refresh my mind ( I am not configuring the machine right now ), so forgive me if the explanations are not clear and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rudylee.github.io/blog/2010/08/30/add-bridge-assign-unique-ip-for-each-container-in-openvz/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="blog.rudylee.com" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">mob</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">blog.rudylee.com</a></h1>
  
    <h2>keep it humble</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rudylee.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">Add Bridge and Assign Unique IP for Each Container in OpenVZ</h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-08-30T13:33:27+10:00" pubdate data-updated="true">Aug 30<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I am writing this tutorial to refresh my mind ( I am not configuring the machine right now ), so forgive me if the explanations are not clear and structured.</p>

<p>After successfully installed the OpenVZ, you need to configure the IP for the containers. If you are using the built in &ldquo;Venet&rdquo; you will end up making the host as the gateway. In the other words if you traceroute to your container IP, it will going through your host then to your container. Here are the sample of the scenario :</p>

<ol>
<li><p> Host IP : 202.58.181.2</p></li>
<li><p> Container 1 : 202.58.181.50</p></li>
<li><p> Container 2 : 202.58.181.51</p></li>
</ol>


<p>Basically if you use the venet, if you traceroute to the Container 1 the result should be : Your ISP &ndash;> 202.58.181.2 &ndash;> 202.58.181.50 so the IP of the Host is showed up. Same if you try to traceroute to the second container. Thus, my solution to overcome this problem are :</p>

<ol>
<li><p> Make a bridge using brctl command</p></li>
<li><p> Use the Veth instead of Venet</p></li>
<li><p> Put all the Veth into the bridge</p></li>
<li><p> Assign the Host IP to the bridge</p></li>
</ol>


<p>If you are not ASSIGN the host IP to the bridge, you can&rsquo;t access the host machine. I followed the guidelines from this link <a href="http://wiki.openvz.org/Using_veth_and_brctl_for_protecting_HN_and_saving_IP_addresses">http://wiki.openvz.org/Using_veth_and_brctl_for_protecting_HN_and_saving_IP_addresses</a></p>

<p>Here is my /etc/rc.local configuration looks like :</p>

<pre><code>#!/bin/sh
#
# This script will be executed *after* all the other init scripts.
# You can put your own initialization stuff in here if you don't
# want to do the full Sys V style init stuff.

touch /var/lock/subsys/local
brctl addbr vzbr0
brctl addif vzbr0 eth0
brctl addif vzbr0 veth1.0
brctl addif vzbr0 veth2.0
brctl addif vzbr0 veth3.0
brctl addif vzbr0 veth4.0
ifconfig vzbr0 0
ip addr add 202.58.181.2/25 dev vzbr0
cd /usr/local/webvz/ &amp;&amp; /usr/bin/ruby script/server &amp;&gt;/dev/null &amp;
</code></pre>

<p>I&rsquo;ll update this post if I need to configure another VPS Server.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">admin</span></span>

      








  


<time datetime="2010-08-30T13:33:27+10:00" pubdate data-updated="true">Aug 30<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/unix-and-linux/'>Unix and Linux</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://rudylee.github.io/blog/2010/08/30/add-bridge-assign-unique-ip-for-each-container-in-openvz/" data-via="" data-counturl="http://rudylee.github.io/blog/2010/08/30/add-bridge-assign-unique-ip-for-each-container-in-openvz/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/blog/2010/08/12/sydney-php-group/" title="Previous Post: Sydney PHP Group">&laquo; Sydney PHP Group</a>
      
      
        <a class="basic-alignment right articlenav" href="/blog/2010/09/30/redcar-textmate-alike-editor/" title="Next Post: Redcar : Textmate alike editor">Redcar : Textmate alike editor &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/05/27/playing-with-google-map-api/">Playing with Google Map API</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/16/override-module-config-in-zend-framework-2/">Override module config in Zend Framework 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/06/zend-framework-2-the-proper-way-to-set-application-path-in-javascript-object/">Zend Framework 2 : The proper way to set application path in Javascript Object</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/30/my-review-after-two-months-using-vim/">My review after two months using VIM</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/15/zend-framework-2-get-server-url-in-controller-without-using-serverurl/">Zend Framework 2 : get server URL in controller without using serverUrl()</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Rudy Lee -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blogrudylee';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://rudylee.github.io/blog/2010/08/30/add-bridge-assign-unique-ip-for-each-container-in-openvz/';
        var disqus_url = 'http://rudylee.github.io/blog/2010/08/30/add-bridge-assign-unique-ip-for-each-container-in-openvz/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
